import zlib

decompressor = zlib.decompressobj(wbits=31)  # 31 is magic number for gzip

# Arrives initially
chunk1 = bytes.fromhex("1F 8B 08 00 00 00 00 00 00 03 00 00 00 FF FF")
chunk2 = bytes.fromhex(
    "32 B0 8A 56 2A 31 73 D6 4D 75 37 CF 4C 2F 30 08 33 C8 CD 72 4B CB 4C 0F 4E 55 D2 89 8E 56 4A CE C8 CC 49 29 4A CD 53 D2 51 8A 8F 0F 70 74 77 8D 8F B7 AF 8E 51 2A 4F CC 2C 89 51 B2 8A 51 CA CF 8B 51 D2 89 51 2A 4E 4D 2C 4A CE 00 8B 14 64 66 27 C6 28 D5 2A E9 44 93 AC A3 BA 36 56 47 49 C5 C7 10 64 73 AC 4E B4 92 8A 8F 91 92 4E 5E 69 4E 4E 2C 08 70 01 00 00 00 FF FF"
)
chunk3 = bytes.fromhex(
    "EC 56 C1 8E E2 30 0C BD F3 15 91 85 F6 D4 40 29 05 41 25 3E 60 24 B4 17 8E 88 83 49 DD 36 4B 9A 44 4D 0A 83 D0 FC FB 2A 2D CC 80 C4 6A 56 73 E6 92 CA 6E FC FC FC DE 21 9E 66 6F 17 90 39 64 90 CE 16 4B 88 40 54 AD 3E 38 C8 B6 B0 9C 4E 32 E7 D1 4B 31 EE 93 63 B4 76 6C B1 24 9E 52 9A 4C E7 B4 14 FB 02 17 F3 69 31 FA E3 60 17 81 C6 9A 20 83 4D 47 E3 4D DB D6 43 04 E8 CE 5A 40 56 A0 72 F4 31 48 33 18 6E 1A 42 E1 47 AE 75 96 B4 23 18 4C B2 ED 16 86 10 81 23 E1 A5 D1 3D C1 E8 02 42 A1 73 BF 7B D4 42 D1 3B 0B 07 17 46 75 44 AF 2A DE 8A 87 EB E9 AD F0 A3 9B 34 E4 D2 0E 35 F0 59 05 49 7E 05 C9 56 A1 C3 05 0A 54 6A 8F E2 10 66 0D 77 5B F5 B4 6F D9 C8 9C B9 3A 0B DF D0 DA F1 84 D5 F9 5D 38 65 AA BC 0B 53 56 A2 E5 69 97 44 CB E7 CC 9E 79 CA EC 9E CF 12 66 15 0A E2 D2 53 ED B8 F3 0D 79 51 3D 9B 24 97 C7 A7 54 F6 A6 C9 A9 61 8D 69 75 4E 39 AF 73 B6 2F 79 D9 E0 99 CF E3 98 F5 7F FB 38 89 63 56 18 ED B9 36 4D 8D 8A 59 9E B0 07 01 7B 92 CF 9A 3B 8B CF 0D 70 0D 37 5A 9D 1F 6A 60 6D 30 97 BA 64 D6 1C A8 36 7A 34 1A C1 A7 F8 FF 1A A3 23 12 FA 27 81 BF 53 E8 89 A7 71 CC 2A 9E DE 66 63 A8 65 1D F2 B6 55 8E BE 87 AC F8 36 89 63 FB BE 63 27 5E B4 4A 3D 02 FF 10 F4 27 3C 77 DF A2 BE 4C 7C 99 F8 32 F1 65 E2 CB C4 FF 33 31 F8 78 2F D1 70 3D BB BA DB 6D 31 83 E4 A6 74 4D 1E 21 82 38 BC ED A2 C2 66 43 1E 32 68 7D C1 17 5F E4 BC F4 8A 20 82 49 7F EB 13 B5 DF 59 82 F4 85 69 58 58 15 BE 6A AE C0 49 28 B9 AE 38 47 49 27 6B 9A B0 DF 08 A3 3D E9 D0 EA 24 73 5F AD 72 3A 4A 41 BC 0B 22 26 B5 F4 12 15 77 02 15 AD 26 81 F9 E0 2F 00 00 00 FF FF"
)

# Arrives 2 seconds later
chunk4 = bytes.fromhex(
    "EC DA 4F 6F 9B 30 18 06 F0 7B 3F 45 94 F3 08 98 00 09 B9 4D DA A5 B7 7E 81 1C 1C 70 B0 17 07 23 DB 34 EB A4 7E F7 C9 84 04 2A D9 EB 1F 4F 9A 25 FB 56 54 84 78 F0 F3 E3 85 88 DC B9 07 0E 4A 54 BE FC ED 35 19 57 93 FE 3F 3B 1F 68 D2 CF 5E 48 72 7C 89 2A D4 4A C4 17 D7 A4 D7 0D ED 11 E5 74 C0 69 F1 1F 7F 2C 76 8B 59 81 6B CD 4E A3 66 C9 59 DB 68 FE 9D E6 AF FB F9 3D 87 9C A7 BD 86 2A 2C 77 69 92 7C 5B 62 44 1A 2C C7 0D C1 2B 85 4D CA 4E EC E2 98 C3 CB AA 21 12 F7 87 5E 20 3E D6 6A 55 B1 73 FC C4 4E E8 FB D3 63 2C 3A 4E 24 12 F1 19 0A 89 F8 7D 73 BC 59 C4 4C 62 C4 63 76 3C 92 4A 55 0E 72 79 61 FC 14 A7 F9 AA 53 E7 BC 84 54 B5 54 75 BB C2 BD BA 3A 06 F1 B7 BF 04 A2 C7 DB 85 AD 39 EB 22 81 61 CD 2E 6A B1 39 A2 50 92 67 B4 F8 1D 81 4F C9 FF 27 EB A5 0E FB EE 82 DD 83 DE EE 22 F7 DD 87 B6 83 24 D9 26 A1 F0 5F 2E FC 70 FD 9C ED FC 70 76 BA DA 47 9C 55 A7 48 48 C8 BD 01 30 8B 6C A6 00 02 05 2B 0A C0 69 0A 40 4B E1 80 E8 F0 2C E4 09 83 6B 5C 33 81 34 10 B0 22 90 3A 4D 20 D5 12 E8 54 9B BD 1A 06 F7 C4 66 08 EB 00 C1 0A C2 DA 69 08 6B 3D 04 5C 7B 64 00 D7 7F A9 7F 16 EA 6F 55 FF CC E9 FA 67 DA FA 53 72 E0 1E 3D 0A 5D E3 9A 09 84 5F 82 EC 08 B8 FB 63 D0 70 76 5A 02 15 13 1D 85 2F FE 20 B8 05 36 32 28 C3 24 B0 62 50 3A 3D 09 4A FD 24 60 9C 34 A4 85 34 AA 60 E7 8F 85 37 A9 CD 20 C2 5C B0 03 E1 F4 5C 28 F5 73 01 33 D4 B6 7E 69 98 22 9B 29 14 81 82 15 85 C2 69 0A 85 96 82 20 6D CB B0 5F 16 66 99 CD 18 36 01 83 15 86 8D D3 18 36 5A 0C 7D CB 9E A1 5F 16 A6 C8 66 0A DB 40 C1 8A C2 D6 69 0A 5B 2D 85 13 A4 4C F8 45 61 8A 6C A6 50 06 0A 56 14 4A A7 29 94 5A 0A 90 32 EA D9 54 98 22 9B 28 80 2C 4C 05 1B 0A 20 73 79 2A 80 4C 3F 15 3A C8 65 8B B8 5F 18 E6 A1 8D 1C F2 C0 C1 8A 43 EE 34 87 5C CF 41 7D 74 30 5E 2B 4F DE 9C C7 C0 46 06 45 F8 FE D4 8A 41 E1 F2 F7 A7 A0 D0 7F 7F 7A 61 9C D6 7E CD 84 29 B2 91 42 78 57 B0 A3 E0 F4 BB 02 30 BC 2B 34 67 F8 CB 1F 05 43 DA 09 C0 FE 75 FF F0 07 00 00 FF FF 03 00 A7 11 7B 54 27 3E 00 00"
)

chunks = [chunk1, chunk2, chunk3, chunk4]
decompressed_data = b""

# Let's try to decompress subsets of the data.
for i in range(0, len(chunks)):
    try:
        # Get the subset of the data.
        chunk = chunks[i]

        # Try to decompress the subset.
        decompressed_data = decompressor.decompress(chunk)

        if i == len(chunks) - 1:
            decompressed_data = decompressed_data + decompressor.flush()

        # If we reach this line without an error, the decompression was successful.
        print("\n\nDecompressed data:", i, decompressed_data)

    except zlib.error:
        # If decompression failed, just pass and try the next subset.
        print("\n\nError decompressing data with chunks up to:", i + 1)


try:
    decompressed_data = decompressor.flush()
    if len(decompressed_data) > 0:
        print("\n\nDecompressed data:", decompressed_data)
except zlib.error:
    pass
